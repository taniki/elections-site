---
title: résultats des élections législatives de 2022
---

```js
const resultats_t1 = (
	aq
	.loadCSV(
		'https://raw.githubusercontent.com/taniki/legislatives-2024/main/lg2022_t1_resultats.csv',
		{
			autoType:false,
			parse:{
				NbVoix: parseInt
			}
		}
	)
)

const resultats_t2 = (
	aq
	.loadCSV(
		'https://raw.githubusercontent.com/taniki/legislatives-2024/main/lg2022_t2_resultats.csv',
		{
			autoType:false,
			parse:{
				NbVoix: parseInt
			}
		}
	)
)
```

```js
const resultats_t1_wide = (
	aq
	.from(resultats_t1)
	.groupby('CodCirc2')
	.pivot('CodNua', 'NbVoix')
)
```

## répartition des sièges


```js
const composition_t2 = (
	resultats_t2
	.transform(
		votes_to_resultats
	)
	.concat(
		resultats_t1
		.filter(d=> d.Elu == "oui")
	)
	.transform(
		resultats_to_composition
	)
)
```

<!-- ```js
composition_t2.rollup({ total: d => aq.op.sum(d.sieges) }).get('total')
``` -->

<div class="grid grid-cols-2">
<div>

```js
plot_composition_bar(composition_t2)
```

```js
Inputs.table(composition_t2)
```

</div>
<div>

```js
const t2_majorite = (
	composition_t2
	.orderby(aq.desc('sieges'))
	.slice(0,1)
)

//display(Inputs.table(t2_majorite))
```

C'est la nuance <code>${t2_majorite.get('CodNua')}</code> qui a une majorité ${(t2_majorite.get('sieges') > 289)? 'absolue': 'relative'} avec ${t2_majorite.get('sieges')} sièges.

</div>
</div>


```js
const composition_to_coalitions = (composition) => (
	composition
	.cross(composition)
	.transform(
		table => (
			table
			.filter(d => d.CodNua_1 == d.CodNua_2)
			.derive({
				coalition: d => d.sieges_1
			})
			.concat(
				table
				.filter(d => d.CodNua_1 != d.CodNua_2)
				.derive({
					coalition: d => d.sieges_1 + d.sieges_2
				})
			)

		)
	)
	// .groupby('CodNua_1')
	// .pivot('CodNua_2', 'coalition')
)
```

### quelles coalitions pour avoir une majorité absolue ?

```js
const coalitions_t2 = composition_t2.transform(composition_to_coalitions)
```

```js
const plot_coalitions = coalitions => (
	Plot.plot({
		// color:{
		// 	domain: [0, 289],
		// 	scheme: 'RdYlGn'
		// },
		marks: [
			Plot.cell(
				coalitions_t2,
				{
					x: 'CodNua_2',
					y: 'CodNua_1',
					fill : d => (d.coalition >= 289)? 'green' : 'white'
				}
			),
			Plot.text(
				coalitions_t2,
				{
					x: 'CodNua_2',
					y: 'CodNua_1',
					text : 'coalition'
				}
			)
		]
	})
)
```

```js
plot_coalitions(coalitions_t2)
```

### représentation classique

### représentation en hémicycle

## la composition de l'assemblée s'il n'y avait qu'un tour

```js
const votes_to_resultats = (votes) => (
	votes
	.orderby(aq.desc('NbVoix'))
	.groupby('CodCirc2')
	.rollup({
		NbVoix: d => aq.op.max(d.NbVoix)
	})
	.join(aq.from(votes))
)

const resultats_to_composition = (cironscriptions) => (
	cironscriptions
	.groupby('CodNua')
	.rollup({
		sieges: d => aq.op.valid(d.NbVoix)
	})
)
```

```js
const composition_t1_max = (
	resultats_t1
	.transform(
		votes_to_resultats,
		resultats_to_composition
	)
	.join(
		composition_t2
		.derive({
			reel: d => d.sieges
		})
		.select('CodNua','reel')
	)
	.derive({
		diff: d => d.reel - d.sieges
	})
)

const majorite_t1_max = composition_t1_max.orderby(aq.desc('sieges')).slice(0, 1)
```

```js
const plot_composition_bar = (composition) => {
	return Plot.plot({
		marks: [
			Plot.barX(
				composition,
				{
					y: 'CodNua',
					x: 'sieges'
				}
			),
			Plot.ruleX(
				[289],
				{
					stroke: "#bbb",
					strokeDasharray: [2,1]
				}
			)
		]
	})
}
```

<div class="grid grid-cols-2">
<div>

```js
plot_composition_bar(composition_t1_max)
```

```js
Inputs.table(composition_t1_max)
```
  
</div>
<div>

C'est alors la nuance <code>${majorite_t1_max.get('CodNua')}</code> qui a une majorité ${(majorite_t1_max.get('sieges') > 289)? 'absolue': 'relative'} avec ${majorite_t1_max.get('sieges')} sièges.

</div>
</div>


### coalitions

```js
plot_coalitions(composition_t1_max.transform(composition_to_coalitions))
```

## circonscriptions avec un faible écart au second tour

```js
const ecarts_faibles = (
	(await d3.csv('https://raw.githubusercontent.com/taniki/legislatives-2024/main/lg2022_t2_ecartsfaibles.csv'))
)
```

```js
Inputs.table(ecarts_faibles, {
	format: {
		CodCirc2: circ => html`<a href="/legislatives/circonscription#${circ}">${circ}</a>`
	}
})
```